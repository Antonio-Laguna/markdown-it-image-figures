!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){function t(t,n){return(Array.isArray(t)?t:[]).filter(function(t){return t[0]!==n})}function n(n,e){n&&n.attrs&&(n.attrs=t(n.attrs,e))}module.exports=function(e,r){r=r||{},e.core.ruler.before("linkify","image_figures",function(i){for(var a=1,s=1,o=i.tokens.length;s<o-1;++s){var c=i.tokens[s];if("inline"===c.type&&c.children&&(1===c.children.length||3===c.children.length)&&(1!==c.children.length||"image"===c.children[0].type)){if(3===c.children.length){var l=c.children;if("link_open"!==l[0].type||"image"!==l[1].type||"link_close"!==l[2].type)continue}if(!(0!==s&&"paragraph_open"!==i.tokens[s-1].type||s!==o-1&&"paragraph_close"!==i.tokens[s+1].type)){var f=i.tokens[s-1];f.type="figure_open",f.tag="figure",i.tokens[s+1].type="figure_close",i.tokens[s+1].tag="figure",r.dataType&&i.tokens[s-1].attrPush(["data-type","image"]);var p=void 0;if(r.link&&1===c.children.length){p=c.children[0];var u=new i.Token("link_open","a",1);u.attrPush(["href",p.attrGet("src")]),c.children.unshift(u),c.children.push(new i.Token("link_close","a",-1))}if(p=1===c.children.length?c.children[0]:c.children[1],r.figcaption){var h=void 0,d=p.attrs.find(function(t){return"title"===t[0]});if(Array.isArray(d)&&(h=d[1]),h){var g,y=e.parseInline(h,i.env)[0];c.children.push(new i.Token("figcaption_open","figcaption",1)),(g=c.children).push.apply(g,y.children),c.children.push(new i.Token("figcaption_close","figcaption",-1)),p.attrs&&(p.attrs=t(p.attrs,"title"))}}if(r.copyAttrs&&p.attrs&&function(){var t=!0===r.copyAttrs?"":r.copyAttrs;f.attrs=p.attrs.filter(function(n){return n[0].match(t)}).map(function(t){return Array.from(t)})}(),r.tabindex&&(i.tokens[s-1].attrPush(["tabindex",a]),a++),r.lazy&&(p.attrs.some(function(t){return"loading"===t[0]})||p.attrs.push(["loading","lazy"])),r.async&&(p.attrs.some(function(t){return"decoding"===t[0]})||p.attrs.push(["decoding","async"])),r.classes&&"string"==typeof r.classes){for(var k=!1,v=0,m=p.attrs.length;v<m&&!k;v++){var _=p.attrs[v];"class"===_[0]&&(_[1]=_[1]+" "+r.classes,k=!0)}k||p.attrs.push(["class",r.classes])}if(r.removeSrc){var A=p.attrs.find(function(t){return"src"===t[0]});p.attrs.push(["data-src",A[1]]),n(p,"src")}}}}})}});
//# sourceMappingURL=markdown-it-images-figures.umd.js.map
